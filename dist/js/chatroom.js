!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=156)}({0:function(t,e){var n=t.exports={version:"2.5.7"};"number"==typeof __e&&(__e=n)},1:function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},10:function(t,e,n){"use strict";e.__esModule=!0;var r,i=n(32),u=(r=i)&&r.__esModule?r:{default:r};e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,u.default)(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()},11:function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},12:function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},13:function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},14:function(t,e,n){var r=n(5),i=n(16);t.exports=n(2)?function(t,e,n){return r.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},15:function(t,e,n){var r=n(17);t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}}},152:function(t,e){},153:function(t,e){},154:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(18);n(153);var i={data:[],curId:"",widthCount:0,heightCount:0,width:0,height:0,selectFn:null,$list:null,$input:null,createDataStruc:function(){for(var t=this.heightCount,e=this.widthCount,n=[],r=1;r<=t;++r)for(var i=1;i<=e;++i){var u={};u.id=r+","+i,u.up=1===r?t+","+i:r-1+","+i,u.down=r===t?"1,"+i:r+1+","+i,u.left=1===i?r+","+e:r+","+(i-1),u.right=i===e?r+",1":r+","+(i+1),u.isCur=!1,n.push(u)}this.data=n},createHtml:function(){var t=this,e="";return this.data.forEach(function(n){var r=n.id.split(","),i=r[0],u=r[1],o=-(u-1)*t.width,a=-(i-1)*t.height;e+='<a class="emotions-item emotions-'+i+"-"+u+'" style="background-position: '+o+"px "+a+'px;"></a>'}),e+='\n      <input type="text" class="js-receiveKey">\n    '},updateData:function(t){for(var e=this.data,n=e.length;n--;){var r=e[n];if(!0===r.isCur){r.isCur=!1;break}}for(n=e.length;n--;){var i=e[n];if(i.id===t)return void(i.isCur=!0)}},updateUI:function(t){this.$list;var e=this.$.bind(this),n=t.split(","),r=n[0],i=n[1],u=e(".isCur");u.classList.remove("isCur"),(u=e(".emotions-"+r+"-"+i)).classList.add("isCur")},update:function(t){this.updateData(t),this.updateUI(t)},getEmotion:function(){var t=this.curId.split(",");return"["+t[0]+","+t[1]+"]"},control:function(t){var e=this;switch(t.keyCode){case 37:r("left");break;case 38:r("up");break;case 39:r("right");break;case 40:r("down");break;case 13:var n=this.getEmotion();this.selectFn(n)}function r(t){for(var n,r=0;n=e.data[r++];)if(n.id===e.curId){e.curId=n[t];break}e.update(e.curId)}},$:function(t){return this.$list.querySelector(t)},bindEvent:function(){this.$input.addEventListener("keyup",this.control.bind(this),!1)},init:function(t){this.widthCount=t.widthCount,this.heightCount=t.heightCount,this.width=t.width,this.height=t.height,this.selectFn=t.selectFn,this.$list=t.wrap,this.createDataStruc(),this.$list.innerHTML=this.createHtml(),this.$input=(0,r.$)(".js-receiveKey"),this.bindEvent(),this.data[0].isCur=!0,this.$list.querySelector(".emotions-1-1").classList.add("isCur"),this.curId="1,1"}};e.default=i},155:function(t,e,n){"use strict";var r=n(18),i=o(n(48)),u=o(n(154));function o(t){return t&&t.__esModule?t:{default:t}}n(152);var a=(0,r.$)(".posted-msgs-wrap"),s=(0,r.$)(".msgs-wrap"),c=(0,r.$)(".attr-wrap"),l=((0,r.$)(".js-receiveKey"),(0,r.$)(".popup-wrap")),f=(0,r.$)(".emotions-list"),p=(0,r.$)(".terminal-input-textarea"),d=io.connect(),h="";d.emit("login","请求登陆"),d.on("login",function(t){if(t.name){var e='<p class="system-info">##'+t.name+" entered##</p>";a.innerHTML+=e,h=t.name}else-1===t.retCode&&location.assign("/")}),d.on("chatroom-info",function(t){var e="\n    <p>Total: <span>"+t.names.length+"</span></p>\n  ";t.names.forEach(function(t){e+="<p>"+t+"</p>"}),c.innerHTML=e}),d.on("post-message",function(t){var e="<p>"+(t.name===h?"&gt; ":"")+t.name+"["+t.time+"]: "+t.message+"</p>";a.innerHTML+=e,s.scrollTop="100000000"}),d.on("user-leave",function(t){var e='<p class="system-info">--'+t.name+" left--</p>";a.innerHTML+=e});var v=(0,r.$)(".terminal-input-wrap");new i.default(v,void 0,function(t){d.emit("post-message",t)}),document.addEventListener("keyup",function(t){27===t.keyCode&&l.classList.add("hide")},!1);u.default.init({widthCount:15,heightCount:7,width:29,height:29,selectFn:function(t){v.click(),p.value+=t},wrap:f})},156:function(t,e,n){t.exports=n(155)},16:function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},17:function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},18:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.$=function(t){return document.querySelector(t)},e.$s=function(t){return document.querySelectorAll(t)}},2:function(t,e,n){t.exports=!n(13)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},24:function(t,e,n){var r=n(3);t.exports=function(t,e){if(!r(t))return t;var n,i;if(e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;if("function"==typeof(n=t.valueOf)&&!r(i=n.call(t)))return i;if(!e&&"function"==typeof(n=t.toString)&&!r(i=n.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},25:function(t,e,n){var r=n(3),i=n(1).document,u=r(i)&&r(i.createElement);t.exports=function(t){return u?i.createElement(t):{}}},26:function(t,e,n){t.exports=!n(2)&&!n(13)(function(){return 7!=Object.defineProperty(n(25)("div"),"a",{get:function(){return 7}}).a})},3:function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},30:function(t,e,n){var r=n(8);r(r.S+r.F*!n(2),"Object",{defineProperty:n(5).f})},31:function(t,e,n){n(30);var r=n(0).Object;t.exports=function(t,e,n){return r.defineProperty(t,e,n)}},32:function(t,e,n){t.exports={default:n(31),__esModule:!0}},47:function(t,e){},48:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=o(n(11)),i=o(n(10)),u=n(18);function o(t){return t&&t.__esModule?t:{default:t}}n(47);var a=function(){function t(e,n,i){(0,r.default)(this,t),this.$wrap=e,this.$text=null,this.resultFn=i,this.$textarea=null,this.$blurtab=null,this.$output=n,this.init()}return(0,i.default)(t,[{key:"$",value:function(t){return this.$wrap.querySelector(t)}},{key:"createHtml",value:function(){this.$wrap.innerHTML='\n        <p class="terminal-input-text"></p>\n        <textarea class="terminal-input-textarea" cols="30" rows="10"></textarea>\n      ',this.createFakeTab()}},{key:"createFakeTab",value:function(){if(!(0,u.$)(".js-blur-tab")){var t=document.createElement("input");t.className="js-blur-tab",t.type="text",document.body.appendChild(t)}}},{key:"createContent",value:function(t,e){var n=this.createSpan,r="",i="",u="",o='<span class="cursor-before-and-after cursor-char"></span>',a=t.substring(0,e).split("").map(function(t){return/\s/.test(t)?"&nbsp;":t}),s=t.substring(e,t.length).split("").map(function(t){return/\s/.test(t)?"&nbsp;":t});return 0===a.length&&0===s.length?u=o:a.length>0&&0===s.length?(a.forEach(function(t){r+=n(t)}),u='\n        <span class="cursor-before">\n          '+r+"\n        </span>\n        "+o+"\n      "):s.length>0&&(a.forEach(function(t){r+=n(t)}),s.slice(1).forEach(function(t){i+=n(t)}),u='\n        <span class="cursor-before">\n          '+r+'\n        </span>\n        <span class="cursor-after">\n          <span class="cursor-middle cursor-char '+(/\w/.test(s[0])?"en":"cn")+'">'+s[0]+"</span>\n          "+i+"\n        </span>\n      "),u.replace(/(?:[\r\n]|\s{2,})/g,"")}},{key:"createSpan",value:function(t){return/\w/.test(t)?'<span class="cursor-char en">'+t+"</span>":'<span class="cursor-char cn">'+t+"</span>"}},{key:"focusHandle",value:function(t){var e=this.$text,n=this.$textarea;""===e.innerHTML&&(e.innerHTML='<span class="cursor-before-and-after cursor-char"></span>'),n.focus(),e.classList.add("shrink"),t.stopPropagation()}},{key:"blurHandle",value:function(){this.$text.classList.remove("shrink")}},{key:"tabHandle",value:function(t){var e=this.$blurtab;9===t.keyCode&&e.focus()}},{key:"keyupHandle",value:function(t){var e=this.$wrap,n=this.$text,r=this.$output,i=this.$textarea,u=this.createContent.bind(this),o=this.resultFn;n.innerHTML=u(i.value,i.selectionStart),13===t.keyCode&&(/(?:^-h|^--help)/.test(i.value)?openHelpLayer():o?o(i.value):r?r.innerHTML+=r.innerHTML:e.outerHTML=i.value.replace(/[\r\n]/g,""),i.value="",n.innerHTML='<span class="cursor-before-and-after cursor-char"></span>')}},{key:"bindEvent",value:function(){var t=this.$text,e=this.$textarea;t.addEventListener("click",this.focusHandle.bind(this),!1),document.addEventListener("click",this.blurHandle.bind(this),!1),document.addEventListener("keydown",this.tabHandle.bind(this),!1),e.addEventListener("keyup",this.keyupHandle.bind(this),!1)}},{key:"init",value:function(){this.createHtml(),this.$text=(0,u.$)(".terminal-input-text"),this.$textarea=(0,u.$)(".terminal-input-textarea"),this.$blurtab=(0,u.$)(".js-blur-tab"),this.$content=(0,u.$)(".content"),this.bindEvent(),this.$text.click()}}]),t}();e.default=a},5:function(t,e,n){var r=n(7),i=n(26),u=n(24),o=Object.defineProperty;e.f=n(2)?Object.defineProperty:function(t,e,n){if(r(t),e=u(e,!0),r(n),i)try{return o(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},7:function(t,e,n){var r=n(3);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},8:function(t,e,n){var r=n(1),i=n(0),u=n(15),o=n(14),a=n(12),s=function(t,e,n){var c,l,f,p=t&s.F,d=t&s.G,h=t&s.S,v=t&s.P,y=t&s.B,b=t&s.W,m=d?i:i[e]||(i[e]={}),g=m.prototype,w=d?r:h?r[e]:(r[e]||{}).prototype;for(c in d&&(n=e),n)(l=!p&&w&&void 0!==w[c])&&a(m,c)||(f=l?w[c]:n[c],m[c]=d&&"function"!=typeof w[c]?n[c]:y&&l?u(f,r):b&&w[c]==f?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(f):v&&"function"==typeof f?u(Function.call,f):f,v&&((m.virtual||(m.virtual={}))[c]=f,t&s.R&&g&&!g[c]&&o(g,c,f)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,t.exports=s}});